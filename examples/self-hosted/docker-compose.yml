version: "3.9"

services:
  app:
    image: golang:1.22-alpine
    working_dir: /workspace
    command: sh -c "cd src && IAIP_LOCAL_RUN=1 IAIP_SKIP_CONFIG_PARSE=1 GITHUB_WORKSPACE=/workspace go run ."
    environment:
      - IAIP_LOCAL_RUN=1
      - IAIP_SKIP_CONFIG_PARSE=1
      - GITHUB_WORKSPACE=/workspace
    volumes:
      - ../..:/workspace:ro
    ports:
      - "8080:8080"

  nginx:
    image: nginx:alpine
    depends_on:
      - app
    ports:
      - "8081:8081"
    volumes:
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro

